0x9b7384D697E5c9Fac557c035c0C0837a4221875c# COTI Private ERC-20 Token Development Guide

This guide demonstrates how to create, deploy, and interact with private ERC-20 tokens on the COTI network using confidential computing and AI-assisted development with VSCode + Copilot.

## Prerequisites

- **Node.js**: Version 22 or better installed available [here](https://nodejs.org/en/download)
- **Solc compiler** - [here](https://docs.soliditylang.org/en/latest/installing-solidity.html)
- **Hardhat** - [here](https://hardhat.org/hardhat-runner/docs/getting-started#overview)
- **COTI Metamask Snap** - [beta here](https://github.com/YaruLabs/coti-snap-fork) 


For AI-assisted smart contract development:
- **VS Code**:  [here](https://code.visualstudio.com/download)
- **GitHub Copilot** - [here](https://marketplace.visualstudio.com/items?itemName=GitHub.copilot)


**COTI Account Onboarding**: Complete the account onboarding procedure to obtain your AES encryption key

> üìñ **For detailed instructions**, see the [official COTI onboarding guide](https://docs.coti.io/coti-documentation/build-on-coti/guides/account-onboard)

> üîê **Important**: Save your Private Key and AES key securely - you'll need it for all confidential operations throughout this tutorial.



## Initial Project Setup

Install dependencies in the project root directory and setup the Hardhat environment:

```bash
 üñ•Ô∏è TERMINAL

git clone https://github.com/plucena/coti-erc20
npm install
cd coti-hardhat-template
npm install
```

## Step 1: Create PRIVATE ERC-20 Smart Contract with Github Copilot ‚úÖ COMPLETED

**Status: ‚úÖ CAPIBARA.sol contract has been successfully created**

The CAPIBARA token contract has been generated and includes:
- ‚úÖ Proper inheritance from PrivateERC20 
- ‚úÖ 100,000 tokens pre-minted to `0x9b7384D697E5c9Fac557c035c0C0837a4221875c`
- ‚úÖ totalSupply implementation
- ‚úÖ mint function implementation (owner-only)
- ‚úÖ transfer function implementation (both encrypted and plain uint64 versions)
- ‚úÖ Ownership management with transferOwnership function
- ‚úÖ Maximum supply cap of 10,000,000 tokens

**Contract Location:** `/workspaces/coti-erc20-typescript/coti-contracts/contracts/token/CAPIBARA.sol`

### Key Features Implemented:

1. **Pre-minted Supply**: 100,000 CAPI tokens automatically minted to the specified address during deployment
2. **Owner-only Minting**: Additional tokens can only be minted by the contract owner 
3. **Supply Cap**: Maximum total supply is capped at 10,000,000 tokens
4. **Dual Transfer Methods**: Supports both encrypted (gtUint64) and plain (uint64) transfer functions
5. **Ownership Transfer**: Contract ownership can be transferred to a new address

### Development Process Used:

Using GitHub Copilot, the contract was generated by referencing the existing COTI contracts pattern:

```
ü§ñ GITHUB COPILOT APPROACH

Referenced Files: @PrivateERC20, @IPrivateERC20, @PERCI.sol, @MpcCore
Generated: Complete CAPIBARA.sol with all required functionality
Pattern: Followed COTI's confidential computing implementation
```

### Important Notes:

- **Address Configuration**: The contract uses `0x9b7384D697E5c9Fac557c035c0C0837a4221875c` as specified
- **Ready for Compilation**: Contract is syntactically complete and ready for deployment
- **COTI Integration**: Fully integrated with COTI's MPC (Multi-Party Computation) privacy features

## Step 2: Compile Smart Contract ‚úÖ COMPLETED

**Status: ‚úÖ Contract successfully compiled**

Navigate to the contracts directory and compile your generated contract:

```bash
 üñ•Ô∏è TERMINAL

cd coti-contracts
npx hardhat compile
```

### Compilation Results:
- ‚úÖ **Hardhat installed** and configured (v2.22.8)
- ‚úÖ **Dependencies resolved** for Hardhat 2.x compatibility  
- ‚úÖ **CAPIBARA.sol contract** compiled successfully
- ‚úÖ **Solidity version** 0.8.19 with optimizer enabled
- ‚úÖ **Type definitions** generated for TypeScript

### Key Configuration:
- **Solidity Version:** 0.8.19
- **Optimizer:** Enabled (runs: 10000)
- **Network:** COTI Testnet
- **Gas Settings:** Configured for COTI network requirements

**Compilation output:**


## Step 3: Create Deployment Script with Copilot

### Using Copilot to Generate the Deployment Script


**Execute this prompt in Copilot:**

```
ü§ñ GITHUB COPILOT

@deploy.ts

Create a script similar to @deploy.ts to deploy @CAPIBARA.sol

The script should:
- Follow the same pattern as the referenced deploy.ts
- Deploy the CAPIBARA contract to COTI testnet
- Output the deployed contract address
- Save the scripts on the coti-contracts/scripts folder
```

### Deploy the Contract

## Step 3: Deploy CAPIBARA Token ‚úÖ COMPLETED

**Status: ‚úÖ Successfully deployed to COTI Testnet**

**Deployed Contract Address:** `0xcdbaA8A6afC275b3F5DfD3ee1916049C4213E885`

### Deployment Configuration

1. Navigate to the coti-contracts directory and configure your environment:

```bash
cd coti-contracts
```

2. Ensure your `.env` file contains the required keys:

```.env
PRIVATE_KEY=your_deployer_private_key
SIGNING_KEYS=your_deployer_private_key
# USER_KEYS will be generated automatically during onboarding
```

### Run Deployment

Execute the deployment script:

```bash
 üñ•Ô∏è TERMINAL

npx hardhat run scripts/deploy-capibara-clean.ts --network coti-testnet
```

### Actual Deployment Output:

```
üöÄ Starting CAPIBARA Token deployment...
‚úÖ Deployer account: 0xe45FC1a7D84e73C8c71EdF2814E7467F7C86a8A2
üéâ CAPIBARA Token deployed to: 0xcdbaA8A6afC275b3F5DfD3ee1916049C4213E885
üíé Calling initialMint to mint 100,000 CAPI tokens...
‚úÖ Initial mint completed!

üìä Deployment Summary:
Contract Name: CAPIBARA Token
Symbol: CAPI
Contract Address: 0xcdbaA8A6afC275b3F5DfD3ee1916049C4213E885
Total Supply: 100,000 CAPI tokens
Pre-minted To: 0x9b7384D697E5c9Fac557c035c0C0837a4221875c
```

> üìù **Important**: The deployed contract address is `0xcdbaA8A6afC275b3F5DfD3ee1916049C4213E885` - save this for all subsequent operations.

> üîç **MetaMask Integration**: Encrypted values will be visible in MetaMask, showing the confidential nature of the token balances.

## Step 4: Check the balance using the Metamask COTI Snap

You can check that the token was correctly minting by acessing the Metamask COTI Snap.  
On the tokens tab click import and enter the address of the deployed contract

![A snapshot of the coti application](coti-snap.png)


## Step 5: Create Token Minting Script with Copilot

### Using Copilot to Generate the Minting Script

**Execute this prompt in Copilot:**

```
ü§ñ GITHUB COPILOT

@mint.ts @CAPIBARA.sol

Given @CAPIBARA.sol deployed at YOUR_CONTRACT_ADDRESS, write a hardhat script to call the mint function similar to @mint.ts

The script should:
- Connect to the deployed CAPIBARA contract
- Call the mint function with proper parameters
- Handle the confidential token minting process
- Display transaction details and confirmation
- Show the minted amount in both raw and formatted values
```

### Run the Minting Script

```bash
 üñ•Ô∏è TERMINAL

npx hardhat run scripts/mintCapibara.ts --network coti-testnet
```

**Expected output:**

```
Attempting to call mint on CAPIBARA contract at 0xa7ca50518d4D535bBF239CcbeCCf1CF645bdB692
Minting tokens to: 0xfAF7e0962B79675cd046C4c0bF41beEb27FCc5C8
Value (smallest units): 5000000000
Value (whole tokens): 5000
Using deployer account (owner and recipient for minting): 0xfAF7e0962B79675cd046C4c0bF41beEb27FCc5C8
Transaction sent: 0x7b91a7bd3f805a100951e4a89d0b9de988c280d3512ac6e94e9d8001ea8ab7e5
Transaction confirmed: 0x7b91a7bd3f805a100951e4a89d0b9de988c280d3512ac6e94e9d8001ea8ab7e5
mint called successfully! 5000 CAPI tokens (value: 5000000000) minted to 0xfAF7e0962B79675cd046C4c0bF41beEb27FCc5C8.
```

## Understanding COTI's Confidential Computing

This tutorial demonstrates COTI's unique privacy-preserving blockchain capabilities:

### Key Features:

1. **üîê Private Token Values**: All token balances are encrypted on-chain using COTI's MPC (Multi-Party Computation) technology
2. **üîë Selective Decryption**: Only authorized parties with correct private keys can decrypt and view actual token amounts
3. **‚öôÔ∏è ERC-20 Compatibility**: Despite privacy features, maintains full ERC-20 standard compatibility
4. **ü¶ä MetaMask Integration**: Encrypted values are visible in MetaMask, providing transparency about encrypted data existence

## Github Copilot Best Practices for COTI Development

### Effective Prompting Tips:

- **Use `@` References**: Always reference relevant files with `@filename` for better context
- **Be Specific**: Include exact function names and requirements in your prompts
- **Reference Patterns**: Point to existing similar files as templates
- **Security Focus**: Always ask for proper private key and AES key handling

### File References Guide:

- `@PrivateERC20.sol` - Base contract for private ERC-20 tokens
- `@IPrivateERC20.sol` - Interface definition
- `@PERCI.sol` - Example implementation reference
- `@deploy.ts` - Standard deployment script template
- `@getBalance.ts` - Balance checking script template
- `@mint.ts` - Token minting script template

## Security Checklist

- [ ]  **Never commit private keys** to version control
- [ ]  **Store AES keys securely** - required for decrypting confidential values
- [ ]  **Test on testnet first** before deploying to mainnet
- [ ]  **Verify contract addresses** before interacting with deployed contracts
- [ ]  **Use environment variables** for sensitive configuration data
- [ ]  **Validate all user inputs** in your smart contracts
- [ ]  **Test decryption functionality** with your specific keys before production use
